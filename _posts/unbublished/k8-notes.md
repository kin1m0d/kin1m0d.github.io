












# Kubernetes Architecture

(node = virtual/physical machine)

At least 1 master node (Control Plane)
connected are a couple of worker nodes (just referred to as Nodes)
each node has a "kubelet" process running on it

kubelet is a k8 process makes it possible to talk to the cluster and executes tasks on those nodes, like running application processes
on worker nodes your actual applications are running, as a pod


The master node (control plane)
has a API server running which is also a container, and is an entrypoint to the k8 cluster. If you use k8 dashboard, the UI would talk to the API 
UI, API, and CLI would talk to the API server

another process on the master node is the Controller Manager (c-m), which keeps track of whats happening in the cluster

a third one is the Scheduler (sched), which ensures pods placement. For example node1 has 2 pods running (30% used) and node2 has 5 pods running (60% used), so it would create the next new pod on node1

the next important component is etcd (k8 backing store), it has all the config and status data inside
with a etcd snapshot you can backup and recover the whole cluster



there is also a Virtual Network which enables the communication between all master nodes and worker nodes
turns all the nodes into one machine that contains all the resources

Worker Nodes have most load, that run the apps, are much bigger and need more resources
while master has just a handful of processes, but it's more important, because if you lose a master node you won't have access to the cluster anymore, that's why you should have at least 2 master nodes (on prod), or even more



# Main Kubernetes Components





# Pod
Smalles unit in k8
abstraction over container
container runs in a pod
usually 1 app per pod
pods are ephemeral, if the pod dies a new one will spin up 
each pod gets an internal IP adress

a node could run 



# Service
permanent static IP address
even if the pod dies, IP address stays

# Ingress
make apps accesbile through the browser, you need an external service
to not work with IP addresses in the browser and ports, you would use ingress, which takes the request and forwards it to the service


internal service for the DB


# ConfigMap
External config of your application
for URLs etc.



# Secret
just as configMap but base64 encoded, but that doesn't make them safe, you should encrypt them with 3rd party tools!
this is a config for credentials, store

# Volume
storage on local machine
or remote storage, outside of the k8 cluster

k8 doesn't manage data persistance!


# Deployment
to avoid downtime, everything gets replicated

service is also a load balancer

blueprint for pods, to scale the replicas
deployment is an abstraction of pods

deployment is for stateLESS apps


# StatefuleSet
(sts)
for stateFUL apps, such as databases, mongoDB, mysql etc.

deploying databases with a StatefulSet is not easy! common practise is to host the DB outside of the cluster and just have stateless apps in the cluster


# DaemonSet



##########################################
# Summary

abstraction of containers
- Pod

communication
- Service

route traffic into cluster
- Ingress

external configuration 
- ConfigMap
- Secret

data persistence
- Volumes

replication
- Deployment
- StatefulSet





##########################################


API SERVER 
entry point

UI / API / CLI

kubectl (CLI)

yaml or json

the Controller Manager checks if the desired state is give




each config file has 3 parts

1
metadata:
2
spec: (specification)
3
status:
auto generated by k8, it will check what is the actual state and compares it to the desired state
where is the info coming from? from etcd, it holds the status of any k8 component

##########################################




Minikube

Production Cluster Setup
multiple masters
multiple worker nodes

if you want to test something on your local machine
Minikube = one node cluster, where master and worker processes run in one node


kubectl
commandline tool for k8 cluster, that talks to the API server
a tool to interact with any type of cluster, local Minikube or cloud doesn't matter













##########################################


kubectl get node


you can give labels to any k8 component


kubectl apply -f mongo-config.yaml

kubectl get all

kubectl get configmap
kubectl get secret

kubectl logs <podname> -f 

minikube ip































